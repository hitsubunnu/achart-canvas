function ChartCandlestick(f){this.id=f.id;this.width=f.width||960;this.height=f.height||480;this.title=f.title;this.fx=f.fx;this.ll=f.label_left;this.lb=f.label_bottom;this.data=f.data;this.average=f.average;this.volume=f.volume;this.ratio=f.ratio||0.8;this.digit=f.digit||3;this.zoom=f.zoom||this.width/960}
ChartCandlestick.prototype.draw=function(){var f=this.width,d=this.height,n=this.ratio,a=this.zoom,j=this.ll,r=this.lb,k=this.title,i=this.fx,l=this.average,t=this.volume,y=this.data,E=this.digit,p=n*f,m=0.8*n*d,u=0.2*n*d,h=(1-n)/2*f,c=(1-n)/2*d;j.max=Number(j.max);j.min=Number(j.min);var A=j.max-j.min,z=c+1.05*m;t||(u=0,z=c+m);var f=new Kinetic.Stage({container:this.id,width:f,height:d}),d=new Kinetic.Layer,v=new Kinetic.Layer,n=new Kinetic.Layer,B=new Kinetic.Layer,F=new Kinetic.Layer,I=new Kinetic.Layer,
H=new Kinetic.Layer,C=new Kinetic.Group;H.add(C);var g=["MS Gothic","sans-serif"];l[0].color||(l[0].color="#0099c5");l[1].color||(l[1].color="#ff9900");d.add(new Kinetic.Text({x:h,y:c/2,text:k.string,width:p,align:"center",textFill:"brown",fontSize:16*a,fontStyle:"bold",fontFamily:g}));for(var b=0;b<=j.cali;b++){var k=c+m*(j.cali-b)/j.cali-6*a,e=(j.min+(j.max-j.min)/j.cali*b).toFixed(E).replace(/^([+-]?\d+)(\d\d\d)/,"$1,$2");d.add(new Kinetic.Text({x:0,y:k,text:e,width:h-6*a,align:"right",textFill:"gray",
fontSize:12*a,fontFamily:g}))}e=h+p+6*a;d.add(new Kinetic.Rect({x:e,y:c,width:12*a,height:12*a,fill:"#3366CC"}));d.add(new Kinetic.Text({x:e+16*a,y:c,text:"\u59cb\u5024",textFill:"#3366CC",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var J=new Kinetic.Text({x:e,y:c+20*a,width:h-12*a,align:"right",text:" ",textFill:"#3366CC",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(J);d.add(new Kinetic.Rect({x:e,y:c+40*a,width:12*a,height:12*a,fill:"#3366CC"}));d.add(new Kinetic.Text({x:e+
16*a,y:c+40*a,text:"\u9ad8\u5024",textFill:"#3366CC",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var K=new Kinetic.Text({x:e,y:c+60*a,width:h-12*a,align:"right",text:" ",textFill:"#3366CC",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(K);d.add(new Kinetic.Rect({x:e,y:c+80*a,width:12*a,height:12*a,fill:"#3366CC"}));d.add(new Kinetic.Text({x:e+16*a,y:c+80*a,text:"\u5b89\u5024",textFill:"#3366CC",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var L=new Kinetic.Text({x:e,
y:c+100*a,width:h-12*a,align:"right",text:" ",textFill:"#3366CC",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(L);d.add(new Kinetic.Rect({x:e,y:c+120*a,width:12*a,height:12*a,fill:"#3366CC"}));d.add(new Kinetic.Text({x:e+16*a,y:c+120*a,text:"\u7d42\u5024",textFill:"#3366CC",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var M=new Kinetic.Text({x:e,y:c+140*a,width:h-12*a,align:"right",text:" ",textFill:"#3366CC",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(M);d.add(new Kinetic.Rect({x:e,
y:c+160*a,width:12*a,height:12*a,fill:"#3366CC"}));d.add(new Kinetic.Text({x:e+16*a,y:c+160*a,text:"\u51fa\u6765\u9ad8",textFill:"#3366CC",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var N=new Kinetic.Text({x:e,y:c+180*a,width:h-12*a,align:"right",text:" ",textFill:"#3366CC",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(N);d.add(new Kinetic.Rect({x:e,y:c+200*a,width:12*a,height:12*a,fill:l[0].color}));d.add(new Kinetic.Text({x:e+16*a,y:c+200*a,text:l[0].string,textFill:l[0].color,
fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var O=new Kinetic.Text({x:e,y:c+220*a,width:h-12*a,align:"right",text:" ",textFill:l[0].color,fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(O);d.add(new Kinetic.Rect({x:e,y:c+240*a,width:12*a,height:12*a,fill:l[1].color}));d.add(new Kinetic.Text({x:e+16*a,y:c+240*a,text:l[1].string,textFill:l[1].color,fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var P=new Kinetic.Text({x:e,y:c+260*a,width:h-12*a,align:"right",text:" ",
textFill:l[1].color,fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(P);d.add(new Kinetic.Rect({x:e,y:c+280*a,width:12*a,height:12*a,fill:"#CC0000"}));d.add(new Kinetic.Text({x:e+16*a,y:c+280*a,text:"\u65e5\u4ed8",textFill:"#CC0000",fontSize:12*a,align:"left",fontStyle:"bold",fontFamily:g}));var Q=new Kinetic.Text({x:e,y:c+300*a,width:h-12*a,align:"right",text:" ",textFill:"#CC0000",fontSize:12*a,fontStyle:"bold",fontFamily:g});v.add(Q);i&&d.add(new Kinetic.Text({x:0,y:z,text:"\u53d6\u5f15\u901a\u8ca8:"+
i,width:h-6*a,align:"right",textFill:"gray",fontSize:10*a}));k=t?1.5*c+m+u:1.5*c+m;if(1<r.length)for(b=0;b<r.length;b++)i=h+p/(r.length-1)*b,d.add(new Kinetic.Text({x:i-50*a,y:k,text:r[b],fontSize:12*a,textFill:"gray",fontFamily:g}));for(b=0;b<=j.cali;b++)i=h+p,k=c+m*b/j.cali,d.add(new Kinetic.Line({points:[h,k,i,k],stroke:"#ccc",dashArray:[3,3]}));if(1<r.length)for(b=0;b<r.length;b++)i=h+p/(r.length-1)*b,d.add(new Kinetic.Line({points:[i,c,i,c+m],stroke:"#ccc",dashArray:[3,3]}));for(var q=p/y.length,
b=0;b<y.length;b++)y[b][0]&&function(){var d=y[b][0],e=Number(y[b][1]),f=Number(y[b][2]),g=Number(y[b][3]),i=Number(y[b][4]),k=l[0].values[b],p=l[1].values[b],r=t?t[b]:"",s=h+q/2+q*b,w=c+(j.max-f)/A*m,x=c+(j.max-g)/A*m,n=c+(j.max-e)/A*m,o=c+(j.max-i)/A*m,D,G,E=s-q*0.4;if(n>o){G="#FFFFFF";D=n-o;n=o}else{G="#3366CC";D=o-n}if(e==""||f==""||g==""||D==0){G="#000000";D=1;n=o}F.add(new Kinetic.Path({data:"M"+s+","+w+"L"+s+","+x,stroke:"#3366CC",shadow:{color:"#3366CC",opacity:0.5}}));F.add(new Kinetic.Rect({x:E,
y:n,width:q*0.8,height:D,fill:G,stroke:"#3366CC",shadow:{color:"#3366CC",opacity:0.5}}));var B=new Kinetic.Line({points:[s,c,s,c+m],stroke:"#CC0000",opacity:0}),R=new Kinetic.Line({points:[s,z,s,z+u],stroke:"#CC0000",opacity:0}),S=new Kinetic.Rect({x:s-q,y:z+u,width:q*2,height:5*a,fill:"#CC0000",opacity:0});C.add(B);C.add(R);C.add(S);s=new Kinetic.Rect({x:h+q*b,y:c,width:q,height:m,fill:"#FFF",opacity:0});s.on("mouseover touchmove tap",function(){for(var a=C.getChildren(),b=0;b<a.length;b++)a[b].setOpacity(0);
B.setOpacity(1);R.setOpacity(1);S.setOpacity(1);J.setText(e+"");K.setText(f+"");L.setText(g+"");M.setText(i+"");N.setText(r+"");O.setText(k+"");P.setText(p+"");Q.setText(d);H.draw();v.draw()});I.add(s)}();for(b=0;b<l.length;b++){for(var w=l[b].values,o="",k=i="",x=0;x<w.length;x++)w[x]&&(i=h+p/w.length*x+q/2,k=c+(j.max-w[x])/A*m,o+=o?"L"+i+","+k:"M"+i+","+k);B.add(new Kinetic.Path({data:o,stroke:l[b].color}))}if(t){w=Math.max.apply(null,t);o=Math.min.apply(null,t);x=w-o;d.add(new Kinetic.Rect({x:h,
y:z,width:p,height:u,stroke:"#ccc"}));for(b=1;4>=b;b++)i=h+p,k=c+1.05*m+u*(4-b)/4,d.add(new Kinetic.Line({points:[h,k,i,k],stroke:"#ccc",dashArray:[3,3]})),d.add(new Kinetic.Text({x:e,y:k-6*a,text:(w*b/4/1E3).toFixed(E).replace(/^([+-]?\d+)(\d\d\d)/,"$1,$2"),align:"left",fontSize:12*a,textFill:"gray",fontFamily:g}));d.add(new Kinetic.Text({x:e,y:c+1.05*m+u-6*a,text:"0 (\u5343\u682a)",align:"left",textFill:"gray",fontSize:12*a,fontFamily:g}));for(b=0;b<r.length;b++)i=h+p/(r.length-1)*b,d.add(new Kinetic.Line({points:[i,
z,i,z+u],stroke:"#ccc",dashArray:[3,3]}));for(b=0;b<t.length;b++)F.add(new Kinetic.Rect({x:h+0.1*q+q*b,y:c+1.05*m+(w-t[b])/x*u,width:0.8*q,height:(t[b]-o)/x*u,fill:"#3366CC",shadow:{color:"#3366CC",opacity:0.5}}))}f.add(d);f.add(v);f.add(n);f.add(B);f.add(H);f.add(F);f.add(I)};